<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Daftar - Sarpras</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-orange-50 min-h-screen">
    <!-- Navbar -->
    <nav class="bg-white/95 backdrop-blur border-b border-orange-100 sticky top-0 z-40 shadow-sm">
        <div
            class="max-w-6xl mx-auto px-4 sm:px-6 py-3 sm:py-4 flex flex-col gap-2 sm:gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div class="flex items-center gap-2 sm:gap-3">
                <img src="https://raw.githubusercontent.com/saripudin14/img/refs/heads/main/logo.png" alt="Logo Sarpras"
                    class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl border border-orange-100 shadow-lg shadow-orange-200/70 object-contain bg-white/70 p-1.5 sm:p-2">
                <div>
                    <p class="text-[10px] sm:text-xs uppercase tracking-widest text-orange-500 font-semibold">Unit
                        Sarana & Prasarana
                    </p>
                    <h1 class="text-lg sm:text-xl font-bold text-gray-900 tracking-tight">Daftar Akun</h1>
                </div>
            </div>
            <div class="flex gap-2 sm:gap-3">
                <a href="sarpras.html"
                    class="w-10 h-10 sm:w-11 sm:h-11 rounded-lg sm:rounded-xl border border-orange-200 flex items-center justify-center text-orange-600 bg-white hover:bg-orange-50 hover:border-orange-300 transition-all shadow-sm"
                    title="Kembali ke Dashboard">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                </a>
            </div>
        </div>
    </nav>

    <div class="flex items-center justify-center px-3 sm:px-4 py-6 sm:py-10">
        <div class="max-w-5xl w-full grid gap-6 sm:gap-8 lg:grid-cols-[1.2fr,1fr] items-stretch">
            <div
                class="relative bg-gradient-to-br from-orange-600 via-orange-500 to-amber-400 text-white rounded-2xl sm:rounded-[2.5rem] p-6 sm:p-10 shadow-2xl overflow-hidden h-full flex flex-col justify-between border border-white/20">

                <div class="absolute inset-0 opacity-10 pointer-events-none mix-blend-overlay"
                    style="background-image:url('https://www.transparenttextures.com/patterns/topography.png');"></div>
                <div
                    class="absolute -top-24 -right-24 w-64 h-64 bg-white/20 rounded-full blur-[80px] pointer-events-none">
                </div>
                <div
                    class="absolute -bottom-24 -left-24 w-64 h-64 bg-amber-300/20 rounded-full blur-[80px] pointer-events-none">
                </div>

                <div class="relative z-10">
                    <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-8">
                        <div class="relative group">
                            <div
                                class="absolute inset-0 bg-white/30 blur-md rounded-xl sm:rounded-2xl transform group-hover:scale-110 transition-transform duration-500">
                            </div>
                            <img src="https://raw.githubusercontent.com/saripudin14/img/refs/heads/main/logo.png"
                                alt="Logo Sarpras"
                                class="relative w-12 h-12 sm:w-16 sm:h-16 rounded-xl sm:rounded-2xl bg-white p-1.5 sm:p-2 object-contain shadow-lg ring-1 ring-white/50">
                        </div>
                        <div>
                            <p
                                class="text-[9px] sm:text-[10px] uppercase tracking-[0.2em] sm:tracking-[0.3em] text-orange-100 font-bold mb-1 opacity-90">
                                Unit
                                Sarana &
                                Prasarana</p>
                            <h1 class="text-base sm:text-lg font-bold leading-tight text-white drop-shadow-sm">
                                Universitas
                                Logistik
                                &<br>Bisnis
                                Internasional</h1>
                        </div>
                    </div>

                    <p
                        class="text-orange-50 leading-relaxed mb-6 sm:mb-10 font-light text-sm sm:text-[15px] border-l-2 border-white/30 pl-3 sm:pl-4">
                        Daftarkan akun baru untuk mengakses sistem peminjaman sarana dan prasarana kampus. Pastikan data
                        yang
                        dimasukkan sudah benar.
                    </p>
                </div>

                <div class="relative z-10 grid gap-3 sm:gap-4">
                    <div
                        class="group bg-white/10 hover:bg-white/20 border border-white/20 rounded-xl sm:rounded-2xl p-3 sm:p-4 backdrop-blur-md transition-all duration-300 flex items-start gap-3 sm:gap-4">
                        <div class="bg-white/20 p-1.5 sm:p-2 rounded-lg sm:rounded-xl text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="sm:w-5 sm:h-5">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                                <circle cx="9" cy="7" r="4" />
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                            </svg>
                        </div>
                        <div>
                            <p
                                class="uppercase tracking-widest text-orange-100 text-[9px] sm:text-[10px] font-bold mb-1">
                                Multi Role</p>
                            <p class="text-xs sm:text-sm text-white/90 font-medium">Mahasiswa, Sarpras, dan Security
                                dalam
                                satu sistem.
                            </p>
                        </div>
                    </div>

                    <div
                        class="group bg-white/10 hover:bg-white/20 border border-white/20 rounded-xl sm:rounded-2xl p-3 sm:p-4 backdrop-blur-md transition-all duration-300 flex items-start gap-3 sm:gap-4">
                        <div class="bg-white/20 p-1.5 sm:p-2 rounded-lg sm:rounded-xl text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="sm:w-5 sm:h-5">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" />
                                <path d="m9 12 2 2 4-4" />
                            </svg>
                        </div>
                        <div>
                            <p
                                class="uppercase tracking-widest text-orange-100 text-[9px] sm:text-[10px] font-bold mb-1">
                                Verifikasi Aman
                            </p>
                            <p class="text-xs sm:text-sm text-white/90 font-medium">Data terenkripsi dan terverifikasi
                                oleh
                                admin.</p>
                        </div>
                    </div>
                </div>

                <div class="relative z-10 mt-6 sm:mt-8 pt-4 sm:pt-6 border-t border-white/10">
                    <a href="#"
                        class="inline-flex items-center gap-2 text-[11px] sm:text-xs font-medium text-orange-100 hover:text-white transition-colors group">
                        <span>Butuh bantuan teknis? Hubungi Admin</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="group-hover:translate-x-1 transition-transform">
                            <path d="M5 12h14" />
                            <path d="m12 5 7 7-7 7" />
                        </svg>
                    </a>
                </div>
            </div>

            <div
                class="bg-white rounded-2xl sm:rounded-3xl shadow-xl border border-orange-100 p-6 sm:p-10 flex flex-col justify-center space-y-5 sm:space-y-6">
                <div class="text-center space-y-1.5 sm:space-y-2">
                    <p
                        class="text-[10px] sm:text-xs uppercase tracking-[0.25em] sm:tracking-[0.35em] text-orange-500 font-semibold">
                        Buat Akun</p>
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">Daftar</h2>
                    <p class="text-xs sm:text-sm text-gray-500">Isi data berikut untuk mendaftarkan akun baru</p>
                </div>

                <form id="registerForm" class="space-y-3 sm:space-y-4">
                    <div>
                        <label for="nama"
                            class="block text-[10px] sm:text-xs font-semibold text-orange-500 uppercase tracking-widest mb-1.5 sm:mb-2">Nama
                            Lengkap</label>
                        <input type="text" id="nama" name="nama" required
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base border border-orange-100 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-orange-300 focus:outline-none bg-white transition-colors"
                            placeholder="Masukkan nama lengkap">
                    </div>

                    <div>
                        <label for="email"
                            class="block text-[10px] sm:text-xs font-semibold text-orange-500 uppercase tracking-widest mb-1.5 sm:mb-2">Email</label>
                        <input type="email" id="email" name="email" required
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base border border-orange-100 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-orange-300 focus:outline-none bg-white transition-colors"
                            placeholder="contoh@email.com">
                    </div>

                    <div>
                        <label for="password"
                            class="block text-[10px] sm:text-xs font-semibold text-orange-500 uppercase tracking-widest mb-1.5 sm:mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="password" name="password" required
                                class="w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 sm:pr-12 text-sm sm:text-base border border-orange-100 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-orange-300 focus:outline-none bg-white transition-colors"
                                placeholder="Minimal 6 karakter">
                            <button type="button" id="togglePassword"
                                class="absolute right-2.5 sm:right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-orange-500 transition-colors focus:outline-none"
                                aria-label="Tampilkan password">
                                <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" class="sm:w-5 sm:h-5">
                                    <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                                <svg id="eyeOffIcon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" class="hidden sm:w-5 sm:h-5">
                                    <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24" />
                                    <path
                                        d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68" />
                                    <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61" />
                                    <line x1="2" x2="22" y1="2" y2="22" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div>
                        <label for="role"
                            class="block text-[10px] sm:text-xs font-semibold text-orange-500 uppercase tracking-widest mb-1.5 sm:mb-2">Role</label>
                        <select id="role" name="role" required
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base border border-orange-100 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-orange-300 focus:outline-none bg-white transition-colors appearance-none cursor-pointer">
                            <option value="MAHASISWA">Mahasiswa</option>
                            <option value="SARPRAS">Petugas Sarpras</option>
                            <option value="SECURITY">Security</option>
                        </select>
                    </div>

                    <div id="organisasiWrapper" class="hidden">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-1.5 sm:mb-2 gap-1">
                            <label for="organisasiKode"
                                class="block text-[10px] sm:text-xs font-semibold text-orange-500 uppercase tracking-widest">Organisasi</label>
                            <a href="pendaftaran-organisasi.html"
                                class="text-[10px] sm:text-xs text-orange-500 hover:text-orange-600 font-semibold transition-colors">
                                Daftarkan organisasi baru →
                            </a>
                        </div>
                        <div class="relative">
                            <select id="organisasiKode" name="organisasiKode"
                                class="w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-8 sm:pr-10 text-sm sm:text-base border border-orange-100 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-orange-300 focus:outline-none bg-white transition-colors appearance-none cursor-pointer">
                                <option value="">-- Pilih Organisasi (Opsional) --</option>
                            </select>
                            <div
                                class="absolute right-3 sm:right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="sm:w-4 sm:h-4">
                                    <path d="m6 9 6 6 6-6" />
                                </svg>
                            </div>
                        </div>
                        <p class="text-[10px] sm:text-xs text-gray-400 mt-1 sm:mt-1.5">Pilih ORMAWA atau UKM yang sudah
                            terdaftar.</p>
                    </div>

                    <button type="submit" id="registerButton"
                        class="w-full bg-orange-500 text-white py-2.5 sm:py-3 text-sm sm:text-base rounded-xl sm:rounded-2xl font-semibold hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:ring-offset-2 transition shadow-lg shadow-orange-200/60 disabled:opacity-50 disabled:cursor-not-allowed">
                        Daftar Sekarang
                    </button>
                </form>

                <div class="text-center text-xs sm:text-sm text-gray-500">
                    Sudah punya akun?
                    <a href="login.html"
                        class="text-orange-500 hover:text-orange-600 font-semibold transition-colors">Masuk
                        di
                </div>

                <div id="messageBox"
                    class="text-xs sm:text-sm hidden text-center p-2.5 sm:p-3 rounded-lg sm:rounded-xl">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toggle password visibility
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        const eyeIcon = document.getElementById('eyeIcon');
        const eyeOffIcon = document.getElementById('eyeOffIcon');

        togglePassword.addEventListener('click', function () {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);

            eyeIcon.classList.toggle('hidden');
            eyeOffIcon.classList.toggle('hidden');

            this.setAttribute('aria-label', type === 'password' ? 'Tampilkan password' : 'Sembunyikan password');
        });
    </script>
    <script src="assets/js/api.legacy.js"></script>
    <script>
        // Elements
        const roleSelect = document.getElementById('role');
        const organisasiWrapper = document.getElementById('organisasiWrapper');
        const organisasiSelect = document.getElementById('organisasiKode');

        // Toggle organisasi field based on role
        function toggleOrganisasiField() {
            if (roleSelect.value === 'MAHASISWA') {
                organisasiWrapper.classList.remove('hidden');
                loadOrganisasi();
            } else {
                organisasiWrapper.classList.add('hidden');
                organisasiSelect.value = ''; // Reset selection
            }
        }

        // Fetch organisasi list from API
        async function loadOrganisasi() {
            // Only load if not already loaded
            if (organisasiSelect.options.length > 1) return;

            try {
                const data = await fetch(API_BASE + '/organisasi').then(r => r.json());

                if (data && data.length > 0) {
                    data.forEach(org => {
                        const option = document.createElement('option');
                        option.value = org.kode_organisasi;
                        option.textContent = `${org.nama_organisasi} (${org.kode_organisasi})`;
                        organisasiSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Gagal memuat daftar organisasi:', error);
            }
        }

        // Listen for role changes
        roleSelect.addEventListener('change', toggleOrganisasiField);

        // Initial check (show if MAHASISWA is default selected)
        toggleOrganisasiField();

        // Register form submit handler
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const registerButton = document.getElementById('registerButton');
            registerButton.disabled = true;
            registerButton.textContent = 'Mendaftar...';

            const organisasiKodeVal = document.getElementById('organisasiKode').value.trim();
            const roleVal = document.getElementById('role').value;

            const payload = {
                nama: document.getElementById('nama').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                role: roleVal,
                // Only send organisasi_kode if role is MAHASISWA
                organisasi_kode: (roleVal === 'MAHASISWA' && organisasiKodeVal !== '') ? organisasiKodeVal : null
            };

            const messageBox = document.getElementById('messageBox');
            messageBox.classList.add('hidden');

            try {
                const resp = await fetch(API_BASE + '/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await resp.json();

                if (!resp.ok) {
                    throw new Error(data.error || 'Pendaftaran gagal');
                }

                messageBox.textContent = '✓ Pendaftaran berhasil! Mengalihkan ke halaman login...';
                messageBox.className = 'text-sm text-center p-3 rounded-xl bg-green-50 text-green-600 border border-green-200';
                messageBox.classList.remove('hidden');

                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
            } catch (error) {
                messageBox.textContent = '✗ ' + error.message;
                messageBox.className = 'text-sm text-center p-3 rounded-xl bg-red-50 text-red-600 border border-red-200';
                messageBox.classList.remove('hidden');

                registerButton.disabled = false;
                registerButton.textContent = 'Daftar Sekarang';
            }
        });
    </script>
</body>

</html>